# Docker Deployment

Deploy Prediction Guard using Docker containers for easy setup and management.

## Prerequisites

- **Docker** 20.10 or later
- **Docker Compose** 2.0 or later
- **Minimum 8GB RAM** (16GB recommended)
- **50GB free disk space** (for models and data)

## Quick Start

### 1. Download Configuration

```bash
# Clone the deployment repository
git clone https://github.com/predictionguard/deployment.git
cd deployment/docker
```

### 2. Configure Environment

```bash
# Copy environment template
cp .env.example .env

# Edit configuration
nano .env
```

### 3. Start Services

```bash
# Start all services
docker-compose up -d

# Check status
docker-compose ps
```

### 4. Access Admin Panel

Open your browser to `http://localhost:8080/admin` and complete the initial setup.

## Configuration

### Environment Variables

```bash
# Basic Configuration
PREDICTION_GUARD_DOMAIN=localhost
PREDICTION_GUARD_PORT=8080
ADMIN_EMAIL=admin@yourcompany.com
ADMIN_PASSWORD=your-secure-password

# Database Configuration
POSTGRES_DB=predictionguard
POSTGRES_USER=pg_user
POSTGRES_PASSWORD=your-db-password

# Redis Configuration
REDIS_PASSWORD=your-redis-password

# Security
JWT_SECRET=your-jwt-secret-key
ENCRYPTION_KEY=your-encryption-key
```

### Docker Compose Services

#### Core Services
- **api** - Main API server
- **admin** - Admin panel web interface
- **worker** - Background task processing
- **scheduler** - Task scheduling service

#### Data Services
- **postgres** - Primary database
- **redis** - Caching and session storage
- **minio** - Object storage for models

#### Monitoring
- **prometheus** - Metrics collection
- **grafana** - Monitoring dashboard
- **jaeger** - Distributed tracing

## Customization

### Resource Limits

```yaml
# docker-compose.yml
services:
  api:
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '2.0'
        reservations:
          memory: 2G
          cpus: '1.0'
```

### Volume Mounts

```yaml
# Mount custom models directory
services:
  api:
    volumes:
      - ./models:/app/models:ro
      - ./config:/app/config:ro
      - ./logs:/app/logs
```

### Network Configuration

```yaml
# Custom network
networks:
  predictionguard:
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.0.0/16
```

## Model Management

### Adding Models

1. **Download model files** to the models directory
2. **Update model registry** in admin panel
3. **Deploy model** using admin interface
4. **Test model** via API

### Model Storage

```bash
# Models directory structure
models/
├── llama-2-7b-chat/
│   ├── model.safetensors
│   ├── tokenizer.json
│   └── config.json
├── mistral-7b-instruct/
│   └── ...
└── custom-models/
    └── ...
```

## Security Configuration

### SSL/TLS Setup

```yaml
# Add SSL certificates
services:
  nginx:
    volumes:
      - ./ssl/cert.pem:/etc/ssl/certs/cert.pem:ro
      - ./ssl/key.pem:/etc/ssl/private/key.pem:ro
```

### Firewall Rules

```bash
# UFW configuration
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable
```

### Access Control

```yaml
# Environment variables for security
ENABLE_RATE_LIMITING=true
MAX_REQUESTS_PER_MINUTE=100
ENABLE_CORS=true
ALLOWED_ORIGINS=https://yourdomain.com
```

## Monitoring and Logging

### Health Checks

```yaml
# Health check configuration
services:
  api:
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

### Log Management

```yaml
# Logging configuration
services:
  api:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

### Metrics Collection

```yaml
# Prometheus configuration
services:
  prometheus:
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro
```

## Backup and Recovery

### Database Backup

```bash
# Create backup
docker-compose exec postgres pg_dump -U pg_user predictionguard > backup.sql

# Restore backup
docker-compose exec -T postgres psql -U pg_user predictionguard < backup.sql
```

### Model Backup

```bash
# Backup models
tar -czf models-backup.tar.gz models/

# Restore models
tar -xzf models-backup.tar.gz
```

### Configuration Backup

```bash
# Backup configuration
cp -r .env docker-compose.yml ssl/ backup/
```

## Troubleshooting

### Common Issues

#### Port Conflicts
```bash
# Check port usage
sudo netstat -tulpn | grep :8080

# Change port in docker-compose.yml
ports:
  - "8081:8080"
```

#### Memory Issues
```bash
# Check memory usage
docker stats

# Increase memory limits
deploy:
  resources:
    limits:
      memory: 8G
```

#### Permission Issues
```bash
# Fix file permissions
sudo chown -R $USER:$USER models/
sudo chmod -R 755 models/
```

### Logs and Debugging

```bash
# View logs
docker-compose logs -f api

# Debug specific service
docker-compose exec api bash

# Check service status
docker-compose ps
```

---

**Complete documentation coming soon** - Advanced Docker configurations, production deployment guides, and troubleshooting documentation are being developed.
